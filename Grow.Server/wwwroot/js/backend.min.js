function create_search_entity_function(){var n;return t=>{var r=t.target,e=$(r).attr("dat-type"),o=url_search_entities_prefix+e,s=$(r).attr("dat-output"),i=$("#"+s),u=$(r).val(),f=$.now(),h=n=>{$("input, select").each((t,i)=>{var r=$(i).attr("name");r&&(r=r.substring(0,1).toLowerCase()+r.substring(1),r!=="isActive")&&(n[r]&&$(i).val(n[r]),$(i).attr("type")==="checkbox"&&$(i).prop("checked",n[r]),$(i).trigger("change"))})},c=n=>{$(r).removeClass("loading");var t=i.attr("output-version");t!==undefined&&t>f||($(i).show(),i.attr("output-version",f),i.html("<li disabled>-- Select or search again --<\/li>"),n.forEach(n=>{var r=n.name,t;r+=n.contestId?" ("+contest_years[n.contestId]+")":" (created at "+n.createdAt.substring(0,10)+")";t=document.createElement("li");t.innerHTML=r;t.addEventListener("click",()=>h(n));i.append(t)}))},l=()=>{$(r).removeClass("loading");var n="Error fetching entities via AJAX";console.log(n);i.append("<li>"+n+"<\/li>")};if(clearTimeout(n),u===""){i.hide();return}n=setTimeout(()=>{$(r).addClass("loading"),$.get(o,{search:u},c).fail(l)},2e3)}}function create_image_upload_function(){return n=>{for(var e,o,i=n.target,s=$(i).attr("dat-category"),t=$("#"+$(i).attr("dat-output")),u=i.files,f=new FormData,r=0;r<u.length;r++)f.append("fileData",u[r]);e=n=>{var i,r,u;if(t.removeClass("loading"),t.length>0){for(r=0;r<n.length;r++)u=n[r],i=document.createElement("option"),i.innerText=u.name,i.value=u.id,t.append(i);i&&(i.selected=!0)}};o=n=>{t.removeClass("loading");switch(n.status){case 409:alert("Error: A file with this name has already been uploaded.");break;case 404:alert("Misconfiguration: Trying to save file to a nonexistent folder.");break;case 500:alert("Error: No storage connection could be established.")}console.log("Error fetching entities via AJAX")};t.addClass("loading");$.ajax({url:url_create_file_prefix+s,type:"POST",dataType:"json",data:f,contentType:!1,processData:!1,success:e,error:o})}}function create_load_preview_function(){return n=>{var r=$(n.target),e=r.find(":selected"),t=$("#"+r.attr("dat-preview")),i=e.val(),u,f;if(i){if(u=n=>{var i=n.url;t.attr("src",i);t.css("display","block")},f=n=>{var t="Error fetching selected image via AJAX: "+n.status;console.log(t)},!i){t.css("display","none");return}$.getJSON(url_get_file_prefix+i).done(u).error(f)}}}url_select_year="/Admin/Home/SetYear";url_create_file_prefix="/Admin/Api/File?category=";url_search_entities_prefix="/Admin/Api/";url_get_file_prefix="/Admin/Api/File/";var debug;$(document).ready(function(){var n=$("#contest-selector");n.change(function(){var t=n.children("option:selected").val();$.post(url_select_year,{year:t},function(){location.reload()})});$(".img-selector input[type=file]").change(create_image_upload_function());$(".img-selector select").change(create_load_preview_function());$(".img-selector select").trigger("change");$("#search-box #search-input").keyup(create_search_entity_function())});