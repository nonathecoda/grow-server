function getFormValue(n,t){if(n&&t){t=t.substring(0,1).toLowerCase()+t.substring(1);var i=t.split(".",2);return i.length===1?n[t]:getFormValue(n[i[0]],i[1])}}function createFillFormAction(){return n=>{$("input, select, textarea").each((t,i)=>{var u=$(i).attr("name"),r;u&&u!=="IsActive"&&(r=getFormValue(n,u),r&&$(i).val(r),$(i).is("select")&&($(i)[0].selectedIndex=r),$(i).attr("type")==="checkbox"&&$(i).prop("checked",r),$(i).trigger("change"))})}}function createSetInputAction(n,t){$("#"+n).on("change",n=>{var i=$("#"+t),r=i.attr("dat-type");if(!i.val()){var u=$(n.target).val(),f=n=>{i.val(n.name)},e=url_search_entities_prefix+r+"/"+u;$.get(e,{},f)}});return i=>{t&&$("#"+t).val(i.name),$("#"+n).val(i.id)}}$.getUrlParameter=function(n){var t=new RegExp("[?&]"+n+"=([^&#]*)").exec(window.location.search);return t!==null?t[1]||0:!1};$.stringCompareInsensitive=function(n,t){return n===t?!0:String(n).toLowerCase()===String(t).toLowerCase()};$.updateUrlParameter=function(n,t,i=window.location.href){var f="",r=i.split("?"),e=r[0],s=r[1],o="",u,h;if(s)for(r=s.split("&"),u=0;u<r.length;u++)r[u].split("=")[0]!==String(n)&&(f+=o+r[u],o="&");return t===0||t?(h=o+""+n+"="+t,e+"?"+f+h):f?e+"?"+f:e};url_search_entities_prefix="/Api/";$.fn.entitySearch=function(n){var t;n||(n=()=>{});this.on("keyup",i=>{var u=i.target,h=$(u).attr("dat-type"),f=$(u).attr("dat-filter-name"),e=$(u).attr("dat-filter-value"),c=url_search_entities_prefix+h,l=$(u).attr("dat-output"),r=$("#"+l),o=$(u).val(),s=$.now(),a=t=>{var f,e,i;if($(u).removeClass("loading"),f=r.attr("output-version"),f===undefined||!(f>s)){for($(r).show(),r.attr("output-version",s),r.html("<li disabled>-- Select or search again --<\/li>"),e=0,i=0;i<t.length&&i<6;i++){let u=t[i],f=u.name;u.contestId?f+=" ("+contest_years[u.contestId]+")":u.createdAt&&(f+=" (created at "+u.createdAt.substring(0,10)+")");let e=document.createElement("li");e.innerHTML=f;e.addEventListener("click",()=>{let t=u;$(r).hide();n(t)});r.append(e)}t.length>6&&r.append("<li disabled>...<\/li>")}},v=()=>{$(u).removeClass("loading");var n="Error fetching entities via AJAX";console.log(n);r.append("<li>"+n+"<\/li>")};if(clearTimeout(t),o===""){r.hide();return}t=setTimeout(()=>{$(u).addClass("loading");var n={search:o};f!==undefined&&e!==undefined&&(n[f]=e);$.get(c,n,a).fail(v)},2e3)});return this};let file_api_url="/Api/File";$.fn.fileUploader=function(){return this.each((n,t)=>{$(t).find("[id^=file-upload-]").on("change",n=>{var r=n.target,o=$(r).attr("dat-category"),u=$("#"+$(r).attr("dat-output")),f,e,i,s,h;if(o){for(f=r.files,e=new FormData,i=0;i<f.length;i++)e.append("fileData",f[i]);s=n=>{$(t).removeClass("loading"),u&&(u.val(n[0].id),u.trigger("change"))};h=n=>{$(t).removeClass("loading");switch(n.status){case 409:alert("Error: A file with this name has already been uploaded.");break;case 404:alert("Misconfiguration: Trying to save file in a nonexistent category.");break;case 500:alert("Error: No storage connection could be established.")}console.log("Error fetching entities via AJAX")};$(t).addClass("loading");$.ajax({url:file_api_url+"?category="+o,type:"POST",dataType:"json",data:e,contentType:!1,processData:!1,success:s,error:h})}});$(t).find(".search-input").entitySearch(n=>{$(t).find(".file-id-input").val(n.id),$(t).find(".file-name-input").val(n.name),$(t).find(".file-id-input").trigger("change")})}),this};$.fn.imagePreviewer=function(){return this.each((n,t)=>$(t).find(".file-id-input").on("change",n=>{var o=$(n.target),i=$(t).find("[id^=file-preview-]"),u=$(t).find(".file-name-input"),r=$(o).val(),f,e;if(r&&i){if(f=n=>{var t=n.url,r=!1;["gif","png","jpg","jpeg","svg"].forEach(n=>{t.endsWith(n)&&(r=!0)});r&&(i.attr("src",t),i.css("display","block"));u.val()!==n.name&&u.val(n.name)},e=n=>{var t="Error fetching selected image via AJAX: "+n.status;console.log(t)},!r){i.css("display","none");return}$.getJSON(file_api_url+"/"+r).done(f).error(e)}})),this.find(".file-id-input").trigger("change"),this};$.fn.tableExport=function(){var n=(n,t)=>{var r,i;r=new Blob([n],{type:"data:application/csv;charset=utf-8"});i=document.createElement("a");i.download=t;i.href=window.URL.createObjectURL(r);i.style.display="none";document.body.appendChild(i);i.click()},t=(t,i)=>{for(var s,h,f,e,r,c,u,v,l=[],a=t.querySelectorAll("tr"),o=0;o<a.length;o++){for(s=[],h=a[o].querySelectorAll("td, th"),f=0;f<h.length;f++)e=h[f].cloneNode(!0),r=e.querySelector("a"),r!==null&&r.hasAttribute("title")&&(c=document.createElement("span"),c.innerText=r.getAttribute("title"),e.replaceChild(c,r)),s.push(e.innerText.trim());u=s.join(",").trim();u.charAt(0)===","&&(u=u.substr(1));l.push(u)}v="ï»¿"+l.join("\n");n(v,i)};this.each((n,i)=>{var r=$(i).attr("data-target"),u=$(i).attr("data-name");i.addEventListener("click",function(){var o=document.querySelector(r),f=new Date,i=f.getDate(),n,e;i<10&&(i="0"+i);n=f.getMonth()+1;n<10&&(n="0"+n);e=f.getFullYear();t(o,u+"-"+e+n+i+".csv")})})};$.fn.conditionalCollapse=function(){this.each((n,t)=>{var o=$(t).attr("data-if"),r=$(t).attr("data-eq"),s=$(t).attr("data-neq"),f=r!==undefined?!0:!1,u=r!==undefined?r:s,i=$("[name='"+o+"']"),e;if(u!==undefined&&i){i.on("change",n=>{var i=$(n.target).is(":checkbox")?$(n.target).is(":checked")?"true":"false":$(n.target).val();i===u===f?$(t).collapse("show"):$(t).collapse("hide")});e=$(i).is(":checkbox")?$(i).is(":checked")?"true":"false":$(i).val();e===u!==f?$(t).addClass("collapse"):$(t).addClass("collapse show")}})};url_select_year="/Admin/Home/SetYear";var debug;$(document).ready(function(){var n=$("#contest-selector");n.change(function(){var t=n.children("option:selected").val();$.post(url_select_year,{year:t},function(){location.reload()})});$(".pagination").each((n,t)=>{$(t).pagination({pages:$(t).attr("max"),currentPage:$(t).attr("current")})});$("input[type='date'],input[type='datetime-local']").on("change",n=>{var t=n.target._flatpickr,i=$(n.target).val();t&&i&&t.setDate(i)});$("input[type='date']").flatpickr({altInput:!0,altFormat:"d.m.Y",dateFormat:"Y-m-d",enableTime:!1});$("input[type='datetime-local']").flatpickr({altInput:!0,altFormat:"d.m.Y H:i",enableTime:!0,time_24hr:!0});$(".custom-file-input").on("change",function(){var n=$(this).val().split("\\").pop();$(this).siblings(".custom-file-label").addClass("selected").html(n)});$(".export[data-target][data-name]").tableExport();$(".conditional").conditionalCollapse();$(".file-uploader").fileUploader();$(".file-uploader").imagePreviewer();$("#copy-entity-box .search-input").entitySearch(createFillFormAction());$(".search-entity-box").each((n,t)=>{var r=$(t).attr("dat-id"),i=$(t).find(".search-input");i.entitySearch(createSetInputAction(r,i.attr("id")))})});